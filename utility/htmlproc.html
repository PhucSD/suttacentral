<!DOCTYPE html>
<head>
<meta charset="utf8">
<title>HTML Processing Services</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
</script>
<script>window.jQuery || document.write('<script src="http://localhost:8800/js/vendor/jquery-1.10.2.min.js"><\/script>')</script>

<style>
* {
    padding: 0;
    margin: 0;
}
section{
    max-width:40em;
    margin:auto;
    padding: 2em 0 2em 0;
}

form{
    margin: 2em 0 2em 0;
}

p {
    line-height: 1.25em;
}

ul {
    list-style: none;
}

form > ul {
    border: 2px solid black;
}

li {
    padding: 0.1em 0.1em 0.1em 1em;
}

form > ul > li {
    padding: 0.5em 0.5em 0.5em 1em;    
}

form > ul > li {
    border-top: 2px solid black;
}

form > ul > li:first-child{
    border-top: none;
    background: palegoldenrod;
}

form h2 {
    padding:0;
    margin:0;
    text-align:center;
}
[name=tidy-flags] {
    width: 80%;
    height: 6em;
    font-family: monospace;
    font-style: italic;
    display:block;
    margin:auto;
}
textarea[name^=decruft-] {
    width:37em;
    height: 3em;
    font-family: monospace;
}

#decruft input[type=text] {
    width: 75%;
}

code {
    border: 1px solid #ddd;
    background: #eee;
    font-style: normal;
    padding: 1px 0.25em 1px 0.25em;
}

.css, input[name*="-css"] {
    background: #fee;
}

input[name*="-css"][disabled=disabled]{
    background: #eadddd;
}

li:not(:first-child) {
    
}
p {
    margin-bottom: 0.5em;
}

</style>
</head>
<body>
<div>
<section>
<h1>HTML Processing Services</h1>
<p>You can use these online tools to clean up HTML produced by such tools as Microsoft Word, Libre Office, Calibre and various Content Management Systems. This page is optimized for producing HTML for SuttaCentral. This utility can be used by anyone for any purpose, but if you want more options, consider [HTML tidy website] or downloading a copy of tidy. If you are a developer check [github] where the python scripts which are used under the hood are available.

<form formmethod="post" action="./">

<ul><li><h2> Re-encode</h2>
<li><p>These functions only work on text formats (txt, rtf, html, xml), encoding declarations may need to be updated manually. Note that all functions below will automatically convert to utf8 if required, these are required only for special cases.
<li>
<input name="reencode" type="radio" value="csxplus">Convert CSX+ to UTF-8. Only use if you know the document contains CSX+, works for both properly encoded CSX+ and CSX+ which has been mistakenly converted to UTF-8.
<li><input name="reencode" type="radio" value="toutf8">Attempt to convert any document to UTF-8. Use this is if a file seems to have encoding problems.
</li>
</ul>
</form>

<form>

<ul>
<li><h2>Clean up bad HTML</h2>
<li id="lxml">
<input name="cleanup" type="radio" value="applylxml" checked>
Just ensure document is well-formed HTML5 with utf-8 encoding. <p>Minor problems will be fixed automatically and silently. Unlike tidy, does not object to non-HTML5 tags and non-HTML5 attributes. Basically treats the source HTML like a web browser would.</p>
<li id="tidy" > 
<input name="cleanup" type="radio" value="html5tidy" data-flags="--doctype html5 --output-html 1 --replace-color 1 --tidy-mark 0 --quiet 1 --drop-proprietary-attributes 1 --output-encoding utf8"/>Apply HTML5 Tidy
<span class="flags"></span>
<ul><li> Level

<li><input name="tidy-level" type="radio" value=minimal checked>Minimal <em>Tidies the document up largely leaving the markup alone</em>

<li><input name="tidy-level" type="radio" value=moderate data-flags="--clean 1 --join-classes 1 --join-styles 1 --merge-divs 1 --merge-spans 1">Moderate <em>Aggressively cleans up bad markup.</em>

<li><input name="tidy-level" type="radio" value=merciless data-flags="-gdoc">Merciless <em> Be careful with this, it can easily remove useful information such as color from the document.</em>

<li id="tidy-extra"> Extra Options:
<ul>
<li><input name="tidy-wordwrap" type="checkbox" data-flags="-w 0" checked>No line wrap <em>Lines will be broken only at block level tags, like after a <code>&lt;/p&gt;</code></em>
<li><input name="tidy-logicalemphasis" type="checkbox" data-flags="--logical-emphasis 1" checked> Convert <code>&lt;b&gt;</code> to <code>&lt;strong&gt;</code>, <code>&lt;i&gt;</code> to <code>&lt;em&gt;</code>
</ul>
</ul>
Tidy flags: <em> You can edit these if you know what you're doing.</em>
<textarea name="tidy-flags"></textarea>

<li>
<input name="cleanup" type="radio" value="descriptiveclasses">
Tidy document and normalize class names.
<p>Often in markup generated by a word processor, you will find numbered class 'names' and many different ways to represent say, bold blue text.
<p>This option will try it's best to name classes what they are.<br> For example:<br>
<code>&lt;span class="big blue bold"&gt;Wow Heading&lt;/span&gt;</code>

<p>Note that this option <em>produces bad markup</em>, but it is very human readable bad markup. You can then manually replace these entities with the appropriate tags and classes.
<p> This option calls tidy with specific settings similar to "moderate" above.
<input name="cleanup-gimmie-xml" type="checkbox"> Return XML tags.
<p>Instead of the above, would return <code>&lt;spanBigBlueBold&gt;Wow Heading&lt;/spanBigBlueBold&gt;</code>, this can make search-replace particulary straightforward.
<li id="decruft">
<h3> Remove cruft </h3>
<p>Often html documents will have huge quantities of 'boiler-plate' code or even just pointless rubbish. These options can help to effortlessly clear away vast swathes of such cruft.
<ul>

<li><input name="decruft-script" value="script" type="checkbox" checked> goodbye script tags.
<li><input name="decruft-link" value="link" type="checkbox" checked> goodbye link tags.
<li><input name="decruft-style" value="style" type="checkbox"> goodbye style tags.
<li> Matching elements (and their descendents) will be removed.
<textarea name="decruft-discard"></textarea>
<hr>
<li>
<input name="cherrypick" type="checkbox" data-bound="[name=cherrypick-css]">
Replace the contents of body, with only elements that match the following css selector.
<input name="cherrypick-css" type="text"></input><br>
<p><em>For example the entire content of the document might be in the tag <code>&lt;div class="main-content&gt;</code>, if you entered <code class="css">div.main-content</code> above then everything except the contents of the main-content div will be eliminated from the document. The <code>Inspect Element</code> tool in your web browser's right-click menu is invaluable for discovering the parent element you need (Chrome/Chromium's is clearest).
</em></p>
<hr>
<li>
<input name="strip-header" type="checkbox" data-bound="[name=strip-header-css]">Eliminate contents of the header unless they match:
<input name="strip-header-css" type="text"><br>
<p><em> Often there is no useful information in the header. If there is useful meta tags, for example <code>&lt;meta name="keywords" content="..."&gt;</code> and <code>&lt;meta name="translator" content="..."&gt;</code> then you could specify <code class="css">meta[name="keywords"], meta[name="translator"]</code> to save those elements from the cull.</em></p>
</ul>
<li>
<p>Please put all the htm/html/xhtml files you want processed in a zip archive and upload the zip file. Only zip archives are supported. You will receive a zip archive in return.</p>
<input name="zip-file" type="file" required>
<button>Submit</button></p>
</ul>
</form>

<form>
<ul>
<li>
<h2>Finalize HTML files for SuttaCentral</h2>
<li>
<p>Within certain constraints, appropriately marked up HTML code will have the finishing touches put on them. This includes the proper use of section and article, paragraph numbers, menu generation and other details.
<p>If a file lacks required elements then an error report will be generated explaining what needs to be fixed. Sometimes the utility will guess, in which case a warning or notice will be generated.
<p>As a shorthand, where on suttacentral, a tag appears as: <code>&lt;span class="corr"&gt;gacchāmi&lt;/span&gt;</code> or <code>&lt;a class="wp" id="14"&gt;&lt;/a&gt;</code> you may instead use <code>&lt;corr&gt;gacchāmi&lt;/corr&gt;</code> or <code>&lt;wp&gt;14&lt;/wp&gt;</code>, the utility will automatically convert such tags into the proper HTML based on analysis of existing sutta central texts. If it is unable to make sense of a tag it will produce an error. Also if a class is used which is unknown to SuttaCentral, a warning will be generated.
<p>HTML code should be valid HTML5, this means that attributes don't have to be quoted, you can omit many end tags, ids can be numeric and so on.
<li>
<input name="finalize-commit" type="checkbox">Commit texts to the text repository.
<p>If this option is selected then the files will be added to the repository and become visible on the website. This <em>requires</em> that no errors are generated. Furthermore within the zip file, files must either:<ul>
<li>1) have a properly defined 'lang' attribute
<code>&lt;div lang="en"&gt;</code>, or
<li>2) be arranged into folders named the language code:

<code><br>/fr/dn1.html<br>
/fr/dn2.html<br>
/de/dn1.html<br>
/de/dn2.html<br>
</code>
Subfolders are acceptable and encouraged:<br>
<code>/en/bhikkhu-bodhi/dn1.html</code>
</ul>
</p>
<p> For obvious reasons this is not available to the public. If you would like to submit texts, please contact a SuttaCentral team member
<li>
<input name="zip-file" type="file" required>
<button>Submit</button>


</form>

<script>
tidy = {
    tidy: $('[value=html5tidy]'),
    level: $('[name=tidy-level]'),
    extra: $('#tidy-extra input'),
    flags: $('[name=tidy-flags]'),
    updateFlags: function(e){
        var self=tidy, 
            flags = [];
        if (self.tidy[0].checked) {
            $('#tidy ul input, #tidy textarea').removeAttr('disabled');
        } else {
            $('#tidy ul input, #tidy textarea').attr('disabled', 'disabled');
        }
        
        flags.push(self.tidy.attr('data-flags'));
        for (var i = 0; i < self.level.length; i++){
            flags.push($(self.level[i]).attr('data-flags'));
            if (self.level[i].checked)
                break;
        }
        for (var i = 0; i < self.extra.length; i++) {
            if (self.extra[i].checked)
                flags.push($(self.extra[i]).attr('data-flags'));
        };
        self.flags.val(flags.join(' '))        
    },
    init: function(){
        var self=this;
        $('#tidy input, [name=cleanup]').on('change', self.updateFlags);
        self.updateFlags();
    }
}

decruft = {
    decruft: $('[name=decruft]'),
    what: $('[name^=decruft-]'),
    discard: $('[name=decruft-discard]'),
    unwrap: $('[name=decruft-unwrap'),
    update: function(e){
        var self=decruft,
            selectors = [];
        for (var i = 0; i < self.what.length; i++) {
            if (self.what[i].checked){
                selectors.push(self.what[i].value);
            }
        }
        self.discard.val(selectors.join(', '))
    },
    init: function(){
        this.update();
        this.what.on('change', this.update);
    
    }
}

$('[name=tidy-file]').on('change', function(e){
    var self=e.target;
    console.log(e.target.value);
    if (e.target.value.search(/\.zip$/i) == -1){
        self.value = null;
        alert('Only zip files are acceptable.', 'Go away');
        
    }
});

function updateBoundStatus(target) {
    var boundElements = $($(target).attr('data-bound'));
    if (target.checked) {
        boundElements.removeAttr('disabled')
    }
    else {
        boundElements.attr('disabled', 'disabled')
    }
}

$('[data-bound]').on('change', function(e){updateBoundStatus(this)});
$(document).on('ready', function(){
    $('[data-bound]').each(function(){updateBoundStatus(this)});
});

tidy.init();
decruft.init();


</script>